name: (US) Validation

on:
  workflow_call:
    inputs:
      destination:
        description: build output destination
        type: string
      version:
        description: 'App version'
        type: string
      deploy:
        description: 'App version structure on artifactory or e-store'
        type: string
      issue:
        description: 'task/bug number'
        type: string

jobs:     

  validate_permission: 
    runs-on: self-hosted
    steps:

    - name: validate permision for artifact
      if: ${{ github.event.inputs.destination == 'artifact_dev' || github.event.inputs.version == 'artifact_prod_vnv' }}
      run: | 
        echo "âœ… Everybody can run for artifacts"
        exit 0
    
    - name: validate permision for e-store 
      if: ${{ github.event.inputs.destination == 'e_store_enterprise' || github.event.inputs.destination == 'e_store_prod_vnv' }}
      run: | 
        echo "âœ… Everybody can run for artifacts"
        exit 0    
    
    - name: validate for app-store
      if: ${{ github.event.inputs.destination == 'app_store' }}
      run: | 
        if ${{ github.actor != secrets.US_APP_STORE_OWNER }} 
        then 
          echo "ðŸš« You are not the US_APP_STORE_OWNER, you can not trigger this workflow for app store"
          exit 1
        fi        
        exit 0

  validate_version:
    needs: validate_permission
    runs-on: self-hosted
    steps:

    - name: validating default version
      run: |
        if ${{ github.event.inputs.version == '0.0.0' }} 
        then 
          echo "ðŸš« invalid version ${{ github.event.inputs.version }}, please dont user default value"
          exit 1
        fi

    - name: validating empty version
      run: |
        if ${{ github.event.inputs.version == '' }} 
        then 
          echo "ðŸš« invalid empty version, plase provide a value"
          exit 1
        fi

  validate_destination:
    needs: validate_permission
    runs-on: self-hosted    
    steps:

    - name: validate for artifact dev
      if: ${{ github.event.inputs.destination == 'artifact_dev' }}
      run: | 
        echo "is for development"        
        if ${{ github.event.inputs.issue == '' }} 
        then 
          echo "ðŸš« invalid empty issue, build for artifactory requires a valid Jira Issue key "
          exit 1
        fi
        if ${{ github.event.inputs.issue == 'G6X-' }} 
        then 
          echo "ðŸš« invalid issue ${{ github.event.inputs.issue }},please dont use default option"
          exit 1
        fi

    - name: validate for artifact prod_vnv
      if: ${{ github.event.inputs.version == 'artifact_prod_vnv' }}
      run: | 
        echo "is for development"        
        if ${{ github.event.inputs.issue == '' }} 
        then 
          echo "ðŸš« invalid empty issue, build for artifactory requires a valid Jira Issue key "
          exit 1
        fi
        if ${{ github.event.inputs.issue == 'G6X-' }} 
        then 
          echo "ðŸš« invalid issue ${{ github.event.inputs.issue }},please dont use default option"
          exit 1
        fi

    - name: validate for e-store enterprice
      if: ${{ github.event.inputs.destination == 'e_store_enterprise' }}
      run: | 
        echo "is for e-store" 
        exit 0
    
    - name: validate for e-store prod-vnv
      if: ${{ github.event.inputs.destination == 'e_store_prod_vnv' }}
      run: | 
        echo "is for e-store"
        exit 0

    - name: validate for app-store
      if: ${{ github.event.inputs.destination == 'app_store' }}
      run: | 
        echo "is for app-store"  
        exit 0